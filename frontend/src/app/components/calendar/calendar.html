<div class="calendar-container">
  <header class="calendar-header">
    <h2>{{ currentMonthStr }}</h2>
    <div class="calendar-controls">
      <button
        class="icon-btn"
        (click)="toggleEditMode()"
        [class.active]="isEditMode"
        title="Modo Edición"
      >
        <span class="material-symbols-rounded">edit</span>
      </button>
      <div class="divider"></div>
      <button class="icon-btn" (click)="prevMonth()">
        <span class="material-symbols-rounded">chevron_left</span>
      </button>
      <button class="icon-btn" (click)="nextMonth()">
        <span class="material-symbols-rounded">chevron_right</span>
      </button>
    </div>
  </header>

  <div class="calendar-grid" [class.edit-mode]="isEditMode">
    <!-- Weekday Headers -->
    <div class="weekday-header" *ngFor="let day of weekDays">{{ day }}</div>

    <!-- Calendar Days -->
    <div
      class="calendar-day"
      *ngFor="let day of calendarDays"
      [class.other-month]="!day.isCurrentMonth"
      [class.current-month]="day.isCurrentMonth"
      (click)="openAddModal(day)"
    >
      <div class="day-number">{{ day.date }}</div>

      <div class="shifts-list">
        <div
          class="shift-item"
          *ngFor="let shift of day.shifts"
          [class.extra-shift]="shift.extra"
          [title]="shift.name + ' - ' + ' (' + shift.hours + 'h)'"
        >
          <div class="worker-name">{{ shift.name }}</div>
          <div class="hours-badge">{{ shift.hours }}h</div>

          <button
            *ngIf="isEditMode"
            class="delete-shift-btn"
            (click)="deleteShift(shift.id!, $event)"
          >
            ×
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>Agregar Turno - {{ selectedDate }}</h3>

      <div class="form-group">
        <label>Trabajador</label>
        <select [(ngModel)]="selectedWorkerId">
          <option value="" disabled>Seleccionar...</option>
          <option *ngFor="let worker of workers" [value]="worker.id">
            {{ worker.firstName }} {{ worker.lastName }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Horas</label>
        <input type="number" [(ngModel)]="hoursInput" min="1" max="24" />
      </div>

      <div class="form-group-checkbox">
        <input type="checkbox" id="isExtra" [(ngModel)]="isExtraInput" />
        <label for="isExtra">Es Horas Extras</label>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeModal()">Cancelar</button>
        <button class="btn-save" (click)="saveShift()" [disabled]="!selectedWorkerId">
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>
