<div class="dashboard-container">
  <div class="welcome-section">
    <h1>Bienvenido de nuevo</h1>
    <p class="subtitle">Resumen de actividad y métricas principales de la finca.</p>
  </div>

  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando datos...</p>
    </div>
  }

  @if (error) {
    <div class="error-state">
      <span class="material-symbols-rounded">error</span>
      <p>{{ error }}</p>
      <button (click)="loadStats()">Reintentar</button>
    </div>
  }

  @if (stats) {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon income-bg">
          <span class="material-symbols-rounded">trending_up</span>
        </div>
        <div class="stat-info">
          <h3>Ingresos Totales</h3>
          <p class="amount">{{ stats.income | currency }}</p>
          <span class="trend positive">
            <span class="material-symbols-rounded">arrow_upward</span>
            +12.5% vs mes anterior
          </span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon expense-bg">
          <span class="material-symbols-rounded">trending_down</span>
        </div>
        <div class="stat-info">
          <h3>Gastos Totales</h3>
          <p class="amount">{{ stats.expense | currency }}</p>
          <span class="trend negative">
            <span class="material-symbols-rounded">arrow_downward</span>
            +5.2% vs mes anterior
          </span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon balance-bg">
          <span class="material-symbols-rounded">account_balance_wallet</span>
        </div>
        <div class="stat-info">
          <h3>Balance Neto</h3>
          <p class="amount" [class.negative]="stats.balance < 0">
            {{ stats.balance | currency }}
          </p>
          <span class="trend neutral">
            <span class="material-symbols-rounded">remove</span>
            Estable
          </span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon workers-bg">
          <span class="material-symbols-rounded">group</span>
        </div>
        <div class="stat-info">
          <h3>Trabajadores Activos</h3>
          <p class="amount">12</p>
          <!-- Hardcoded for now until WorkerService is integrated -->
          <span class="trend">
            <span class="material-symbols-rounded">check_circle</span>
            Ver listado
          </span>
        </div>
      </div>
    </div>

    <!-- Charts Section (Placeholders for now) -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="card-header">
          <h3>Ingresos vs Gastos</h3>
          <button class="icon-btn">
            <span class="material-symbols-rounded">more_vert</span>
          </button>
        </div>
        <div class="chart-placeholder">
          <p-chart
            type="bar"
            [data]="incomeExpenseChartData"
            [options]="incomeExpenseChartOptions"
            width="100%"
            height="100%"
          ></p-chart>
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3>Producción de Cultivos</h3>
          <button class="icon-btn">
            <span class="material-symbols-rounded">more_vert</span>
          </button>
        </div>
        <div class="chart-placeholder">
          <p-chart
            type="line"
            [data]="cropProductionChartData"
            [options]="cropProductionChartOptions"
            width="100%"
            height="100%"
          ></p-chart>
        </div>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="recent-section">
      <div class="card-header">
        <h3>Transacciones Recientes</h3>
        <button class="view-all-btn" routerLink="/transacciones">Ver todas</button>
      </div>

      @if (stats.recentTransactions.length > 0) {
        <table class="modern-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Categoria</th>
              <th>Monto</th>
              <th>Notas</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            @for (t of stats.recentTransactions.slice(0, 5); track t.id) {
              <tr>
                <td>
                  <div class="date-cell">
                    <span class="material-symbols-rounded icon">calendar_today</span>
                    {{ t.date | date: 'dd/MM/yyyy HH:mm:ss' }}
                  </div>
                </td>
                <td>
                  <span
                    class="badge"
                    [class.badge-income]="t.type === 'INGRESO'"
                    [class.badge-expense]="t.type === 'GASTO'"
                  >
                    {{ t.type === 'INGRESO' ? 'Ingreso' : 'Gasto' }}
                  </span>
                </td>
                <td class="notes-cell">{{ t.category.name }}</td>
                <td class="notes-cell">{{ t.notes || '-' }}</td>
                <td class="amount-cell">{{ t.totalAmount | currency }}</td>
                <td><span class="status-dot completed"></span> Completado</td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <div class="no-data">
          <span class="material-symbols-rounded">inbox</span>
          <p>No se encontraron movimientos recientes.</p>
        </div>
      }
    </div>
  }
</div>
