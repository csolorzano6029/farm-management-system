<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Categorías</h1>
      <p class="subtitle">Gestiona las listas desplegables y clasificaciones del sistema</p>
    </div>
  </div>

  @if (error()) {
    <div class="error-banner">
      {{ error() }}
    </div>
  }

  <div class="layout-grid">
    <!-- Left Sidebar: Types List -->
    <div class="types-sidebar">
      <h3>Tipos de Categorías</h3>
      @if (loadingTypes()) {
        <div class="spinner-sm"></div>
      }
      <ul class="types-list">
        @for (type of types(); track type.id) {
          <li [class.active]="selectedType()?.id === type.id" (click)="selectType(type)">
            <span class="type-name">{{ type.name }}</span>
            <span class="type-code">{{ type.code }}</span>
          </li>
        }
      </ul>
    </div>

    <!-- Main Content: Values List -->
    <div class="values-content">
      <div class="content-header">
        <h2>{{ selectedType()?.name || 'Selecciona un catálogo' }}</h2>
        <button class="btn btn-primary" (click)="openCreateModal()" [disabled]="!selectedType()">
          <span class="material-symbols-rounded">add</span>
          Nueva Categoría
        </button>
      </div>

      @if (loadingValues()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Cargando elementos...</p>
        </div>
      }

      @if (!loadingValues() && selectedType()) {
        <div class="values-list">
          @if (values().length > 0) {
            <table class="modern-table">
              <thead>
                <tr>
                  <th>Código</th>
                  <th>Nombre</th>
                  <th>Descripción</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (val of values(); track val.id) {
                  <tr>
                    <td>
                      <span class="code-badge">{{ val.code }}</span>
                    </td>
                    <td class="name-cell">{{ val.name }}</td>
                    <td class="desc-cell">{{ val.description || '-' }}</td>
                    <td class="actions-cell">
                      <button class="icon-btn" (click)="openEditModal(val)">
                        <span class="material-symbols-rounded">edit</span>
                      </button>
                      <button class="icon-btn delete" (click)="deleteValue(val)">
                        <span class="material-symbols-rounded">delete</span>
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>

            <p-paginator
              [rows]="limit()"
              [totalRecords]="total()"
              [first]="(page() - 1) * limit()"
              [rowsPerPageOptions]="[5, 10, 20, 50]"
              (onPageChange)="onPageChange($event)"
              styleClass="custom-paginator"
              [dropdownAppendTo]="'self'"
            ></p-paginator>
          } @else {
            <div class="no-data">
              <p>No hay elementos en este catálogo.</p>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>

<!-- PrimeNG Dialog -->
<p-dialog
  [(visible)]="showModal"
  [style]="{ width: '500px' }"
  [header]="editingValue() ? 'Editar Categoría' : 'Nueva Categoría'"
  [modal]="true"
  styleClass="p-fluid"
  [draggable]="false"
  [resizable]="false"
  (onHide)="resetForm()"
>
  <div class="field">
    <label>Código (Identificador único)</label>
    <input
      pInputText
      type="text"
      [ngModel]="formCode()"
      (ngModelChange)="formCode.set($event)"
      placeholder="EJ: FERTILIZANTE"
      [disabled]="!!editingValue()"
    />
  </div>

  <div class="field">
    <label>Nombre (Visible)</label>
    <input
      pInputText
      type="text"
      [ngModel]="formName()"
      (ngModelChange)="formName.set($event)"
      placeholder="Ej: Fertilizantes Orgánicos"
    />
  </div>

  <div class="field">
    <label>Descripción</label>
    <textarea
      pInputTextarea
      [ngModel]="formDesc()"
      (ngModelChange)="formDesc.set($event)"
      rows="3"
    ></textarea>
  </div>

  <div class="field">
    <label>Valor Numérico (Opcional)</label>
    <input
      pInputText
      type="number"
      [ngModel]="formNumeric()"
      (ngModelChange)="formNumeric.set($event)"
    />
  </div>

  <ng-template pTemplate="footer">
    <button
      type="button"
      pButton
      pRipple
      label="Cancelar"
      icon="pi pi-times"
      class="confirm-no-btn"
      (click)="closeModal()"
    ></button>
    <button
      type="button"
      pButton
      pRipple
      label="Guardar"
      icon="pi pi-check"
      class="confirm-yes-btn"
      (click)="saveValue()"
    ></button>
  </ng-template>
</p-dialog>

<p-confirmDialog [style]="{ width: '450px' }" styleClass="custom-confirm-dialog"></p-confirmDialog>
